{% extends "base_page.html" %}

{% block page-title %}
Список добавленных слов
{% endblock %}

{% block page-lead %}
Для добавления новых слов перейдите по ссылке под таблицей.
{% endblock %}
  

{% block content %}
<!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"> -->

<!-- <table id="example" class="table table-striped" style="width:100%">
    <thead>
        <tr>
            <th>Name</th>
            <th>Position</th>
            <th>Office</th>
            <th>Age</th>
            <th>Start date</th>
            <th>Salary</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Tiger Nixon</td>
            <td>System Architect</td>
            <td>Edinburgh</td>
            <td>61</td>
            <td>2011-04-25</td>
            <td>$320,800</td>
        </tr>
        <tr>
            <td>Garrett Winters</td>
            <td>Accountant</td>
            <td>Tokyo</td>
            <td>63</td>
            <td>2011-07-25</td>
            <td>$170,750</td>
        </tr>
        <tr>
            <td>Ashton Cox</td>
            <td>Junior Technical Author</td>
            <td>San Francisco</td>
            <td>66</td>
            <td>2009-01-12</td>
            <td>$86,000</td>
        </tr>
        
</table>

<script type="text/javascript" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script> -->
<!-- <script type="text/javascript" src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script> -->
<!-- <script type="text/javascript" src="/static/nicetable.js"></script> -->

<!-- ------------------------------------------------------------------------------------------------------------------------------------------------------ -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<script src="https://code.jquery.com/jquery-3.4.1.js"></script>

<style>
	.hidden{
        display:none;
    }

    .result{
    	max-width:80px; 
    }

</style>

<div class="row">

    
	<div class="col-md-12"></div>

	    <div class="col-md-12">

		    <div class="card card-body">
				
				<!-- Form Wrapper & Button -->
			<button class="btn btn-sm btn-primary" id="add-word">Add word</button>
			<div class="form-wrapper hidden">
				<select class="form-control" id="word-name">
					<option>----------</option>
					<option>Flash Point</option>
					<option>Water</option>
					<option>Distillation</option>
				</select>
				<input class="form-control" type="text" id="word-result">
				<button class="btn btn-sm btn-info" id="create-word">Add</button>
			</div>

                <div class="table-responsive">
					<table class="table table-striped table-sm">
                    <thead>
                        <tr>
						<th scope="col" class="py-3">#</th>
                        <th scope="col" class="py-3">Word</th>
                        <th scope="col" class="py-3">Translation</th>
                        <th scope="col" class="py-3">Example</th>

                        </tr>
                    </thead>
                    <tbody id="words-table">
                        {% for cnt, word, translation, example in words %}
            			<tr>
							<td class="py-3">{{ cnt }}</td>
							<td class="py-3">{{ word }}</td>
							<td class="py-3">{{ translation }}</td>
							<td class="py-3">{{ example }}</td>
            			</tr>
            			{% endfor %}
                    </tbody>
                    </table>
                </div>

		    </div>

	</div>

	<div class="col-md-12"></div>

</div>

<script>

	var newId = 1
	var newWord = {'cnt':`word-${newId}`, 'word':null, 'id':`word-${newId}`, 'translation':null, 'example':null}

	$('#add-word').on('click', function() {
		$(`.form-wrapper`).removeClass('hidden')
	})


	$('#word-result').on('keyup', function() {
		newWord.result = $(this).val()
		console.log(newWord)
	})

	$('#word-name').on('change', function() {
		newWord.name = $(this).val()
		console.log(newWord)
	})

	$('#create-word').on('click', function(){
		if(newWord.name == null) {
			alert('No word selected!')
		} else {
			addRow(newWord)
			$(`#word-name`).val('')
			$(`#word-result`).val('')
			$(`.form-wrapper`).removeClass('hidden')
		}
	})

	var words = [
		// {'cnt':'1', 'word':'ice',  'id':'1', 'translation':'лед', 'example':'Ice melts.'},
		// {'cnt':'2', 'word':'fire', 'id':'2', 'translation':'огонь', 'example':'Fire is burning.'},
		// {'cnt':'3', 'word':'taste','id':'3', 'translation':'вкус', 'example':'You have a good taste.'},
	]

	// var dataURL = 

	for (var i in words){
		addRow(words[i])
	}

	function addRow(obj){
		var row = `<tr scope="row" class="word-row-${obj.id}">
	    			   <td>${obj.cnt}</td>
	    			   <td>${obj.word}</td>
	    			   <td>${obj.translation}</td>
	                   <td id="result-${obj.id}" data-wordid="${obj.id}">${obj.example}</td>
	                   <td>
	                   		<button class="btn btn-sm btn-danger" data-wordid="${obj.id}" id="delete-${obj.id}">Delete</button>
	                   		<button class="btn btn-sm btn-info" disabled data-wordid="${obj.id}" id="save-${obj.id}">Save</button>

	                   		<button class="btn btn-sm btn-danger hidden" data-wordid="${obj.id}" id="cancel-${obj.id}">Cancel</button>
	                   		<button class="btn btn-sm btn-primary hidden" data-wordid="${obj.id}" id="confirm-${obj.id}">Confirm</button>

	                   </td>
	    		   </tr>`
		$('#words-table').append(row)

        $(`#delete-${obj.id}`).on('click', deleteWord)
        $(`#cancel-${obj.id}`).on('click', cancelDeletion)
        $(`#confirm-${obj.id}`).on('click', confirmDeletion)
        
        $(`#result-${obj.id}`).on('click', editResult)

	}

	function editResult() {
        var wordid = $(this).data('wordid')
        var value = $(this).html()

        $(this).unbind()
        $(this).html(`<input class="result form-control" data-wordid="${wordid}" type="text" value="${value}">`)

        $(`.result`).on('keyup', function() {
            var wordid = $(this).data('wordid')
            var saveBtn = $(`#save-${wordid}`)
            saveBtn.prop('disabled', false)
        })
	}

	function saveUpdate() {
        var wordid = $(this).data('wordid')
        var saveBtn = $(`#save-${wordid}`)
        var row = $(`.word-row-${wordid}`)

        saveBtn.prop('disabled', true)
        // row.css("opacity", "0.5")
	}

	function deleteWord() {
        var wordid = $(this).data('wordid')

        var deleteBtn = $(`#delete-${wordid}`)
		var saveBtn = $(`#save-${wordid}`)
		var cancelBtn = $(`#cancel-${wordid}`)
		var confirmBtn = $(`#confirm-${wordid}`)

		deleteBtn.addClass('hidden')
		saveBtn.addClass('hidden')

		cancelBtn.removeClass('hidden')
		confirmBtn.removeClass('hidden')
	}

	function cancelDeletion() {
        var wordid = $(this).data('wordid')

        var deleteBtn = $(`#delete-${wordid}`)
		var saveBtn = $(`#save-${wordid}`)
		var cancelBtn = $(`#cancel-${wordid}`)
		var confirmBtn = $(`#confirm-${wordid}`)

        deleteBtn.removeClass('hidden')
		saveBtn.removeClass('hidden')

		cancelBtn.addClass('hidden')
		confirmBtn.addClass('hidden')
	}

	function confirmDeletion() {
        var wordid = $(this).data('wordid')
        var row = $(`.word-row-${wordid}`)
        row.remove()
	}
</script>

{% endblock %}